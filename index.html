<!-- *** ĞĞĞ§ĞĞ›Ğ Ğ§ĞĞ¡Ğ¢Ğ˜ 1 Ğ¸Ğ· 4 *** -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ğ—Ğ°ÑĞ²ĞºĞ° Ğ½Ğ° Ñ€ĞµĞ¼Ğ¾Ğ½Ñ‚ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ĞµĞ¹</title>
    <style>
        /* â”€â”€ Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ¸ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸ â”€â”€ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1f3c 100%);
            min-height: 100vh;
            color: #e0e6ed;
            overflow-x: hidden;
        }

        /* â”€â”€ Ğ›Ğ¾Ğ³Ğ¾Ñ‚Ğ¸Ğ¿ â”€â”€ */
        .logo-container {
            position: fixed;
            top: 10px;
            left: 15px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #00a8ff, #0078d4);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(0, 168, 255, 0.3);
        }

        .logo-text {
            font-size: 14px;
            font-weight: 700;
            color: #7eb8f7;
            line-height: 1.2;
        }

        .logo-text span {
            display: block;
            font-size: 10px;
            color: #4a8ed4;
            font-weight: 400;
        }

        /* â”€â”€ ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ¸ ÑĞºÑ€Ğ°Ğ½Ñ‹ â”€â”€ */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .main-screen {
            padding-top: 80px;
        }

        /* â”€â”€ Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¸ â”€â”€ */
        h1 {
            text-align: center;
            font-size: 22px;
            margin-bottom: 25px;
            color: #7eb8f7;
            text-shadow: 0 2px 10px rgba(0, 168, 255, 0.2);
        }

        h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #7eb8f7;
            text-align: center;
        }

        /* â”€â”€ ĞšĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ â”€â”€ */
        .card {
            background: linear-gradient(145deg, #1a2a4a, #162040);
            border: 1px solid #2a3a5c;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* â”€â”€ ĞŸĞ¾Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ñ‹ â”€â”€ */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            color: #8899aa;
            font-weight: 500;
        }

        select, input[type="text"], input[type="password"], input[type="tel"],
        input[type="date"], textarea {
            width: 100%;
            padding: 12px 15px;
            background: #0d1b30;
            border: 1px solid #2a3a5c;
            border-radius: 10px;
            color: #e0e6ed;
            font-size: 15px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #00a8ff;
            box-shadow: 0 0 0 3px rgba(0, 168, 255, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        select {
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2300a8ff' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 40px;
        }

        /* â”€â”€ ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ â”€â”€ */
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00a8ff, #0078d4);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 168, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 168, 255, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2a3a5c, #1a2a4a);
            color: #7eb8f7;
            border: 1px solid #2a3a5c;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757, #c0392b);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 13px;
            width: auto;
            display: inline-block;
        }

        /* â”€â”€ ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ (Ğ² ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¸) â”€â”€ */
        .btn-retry {
            display: inline-block;
            margin-top: 8px;
            padding: 6px 16px;
            background: rgba(255,255,255,0.2);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.4);
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-retry:hover {
            background: rgba(255,255,255,0.35);
        }

        /* â”€â”€ ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ â”€â”€ */
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .nav-buttons .btn {
            flex: 1;
            margin-bottom: 0;
        }

        /* â”€â”€ Ğ‘Ğ»Ğ¾Ğº Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»Ñ â”€â”€ */
        .motor-block {
            border: 1px solid #2a3a5c;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(0, 168, 255, 0.03);
        }

        .motor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 600;
            color: #00a8ff;
        }

        .remove-motor {
            background: none;
            border: 1px solid #ff4757;
            color: #ff4757;
            border-radius: 8px;
            padding: 4px 12px;
            cursor: pointer;
            font-size: 12px;
        }

        /* â”€â”€ Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ â”€â”€ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            transform: translateX(calc(100% + 30px));
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 340px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .notification.error {
            background: linear-gradient(135deg, #ff4757, #c0392b);
        }

        .notification.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        /* â”€â”€ Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ â”€â”€ */
        .history-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 12px;
        }

        .history-table th {
            background: #1a2a4a;
            padding: 10px 8px;
            text-align: left;
            color: #7eb8f7;
            font-weight: 600;
            position: sticky;
            top: 0;
            white-space: nowrap;
        }

        .history-table td {
            padding: 8px;
            border-bottom: 1px solid #1a2a4a;
            color: #c0cfe0;
        }

        .history-table tr:hover td {
            background: rgba(0, 168, 255, 0.05);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid #2a3a5c;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* â”€â”€ Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ â”€â”€ */
        .filters {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .filters .form-group {
            margin-bottom: 0;
        }

        /* â”€â”€ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸: Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€ ÑĞ¿Ğ¸ÑĞºĞ° â”€â”€ */
        .list-editor {
            margin-top: 10px;
        }

        .list-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #0d1b30;
            border-radius: 8px;
            margin-bottom: 5px;
        }

        .list-item input {
            flex: 1;
            padding: 8px;
            font-size: 14px;
        }

        .list-item .remove-item {
            background: none;
            border: none;
            color: #ff4757;
            font-size: 18px;
            cursor: pointer;
            padding: 0 5px;
        }

        /* â”€â”€ Ğ¡Ğ¿Ğ¸Ğ½Ğ½ĞµÑ€ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ â”€â”€ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #4a8ed4;
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #1a2a4a;
            border-top-color: #00a8ff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* â”€â”€ Ğ‘ĞµĞ¹Ğ´Ğ¶ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ° â”€â”€ */
        .motor-count-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #00a8ff;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            font-weight: 700;
            margin-left: 5px;
        }

        /* â”€â”€ ĞŸĞµÑ‡Ğ°Ñ‚ÑŒ â”€â”€ */
        @media print {
            body { background: white; color: black; }
            .no-print { display: none !important; }
            .card { border: 1px solid #ccc; box-shadow: none; background: white; }
            .history-table th { background: #f0f0f0; color: black; }
            .history-table td { color: black; border-bottom: 1px solid #ccc; }
        }

        /* â”€â”€ ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ² â”€â”€ */
        @media (max-width: 600px) {
            .container { padding: 10px; }
            h1 { font-size: 18px; }
            .filters { grid-template-columns: 1fr; }
            .nav-buttons { flex-direction: column; }
            .notification { right: 10px; left: 10px; max-width: none; }
        }
    </style>
</head>
<!-- *** ĞšĞĞĞ•Ğ¦ Ğ§ĞĞ¡Ğ¢Ğ˜ 1 Ğ¸Ğ· 4 *** -->
<!-- *** ĞĞĞ§ĞĞ›Ğ Ğ§ĞĞ¡Ğ¢Ğ˜ 2 Ğ¸Ğ· 4 *** -->
<body>

<!-- Ğ›Ğ¾Ğ³Ğ¾Ñ‚Ğ¸Ğ¿ -->
<div class="logo-container no-print">
    <div class="logo-icon">âš¡</div>
    <div class="logo-text">
        Ğ­Ğ»ĞµĞºÑ‚Ñ€Ğ¾Ğ¡ĞµÑ€Ğ²Ğ¸Ñ
        <span>Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ·Ğ°ÑĞ²Ğ¾Ğº</span>
    </div>
</div>

<!-- Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ -->
<div id="notification" class="notification"></div>

<div class="container">

    <!-- â•â•â• Ğ­ĞšĞ ĞĞ ĞĞ’Ğ¢ĞĞ Ğ˜Ğ—ĞĞ¦Ğ˜Ğ˜ â•â•â• -->
    <div id="loginScreen" class="screen active">
        <div style="padding-top: 100px;">
            <h1>âš¡ Ğ—Ğ°ÑĞ²ĞºĞ° Ğ½Ğ° Ñ€ĞµĞ¼Ğ¾Ğ½Ñ‚ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ĞµĞ¹</h1>
            <div class="card">
                <div class="form-group">
                    <label>ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ»Ñ Ğ²Ñ…Ğ¾Ğ´Ğ°</label>
                    <input type="password" id="passwordInput"
                           placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ"
                           onkeypress="if(event.key==='Enter')login()">
                </div>
                <button class="btn btn-primary" onclick="login()">Ğ’Ğ¾Ğ¹Ñ‚Ğ¸</button>
            </div>
        </div>
    </div>

    <!-- â•â•â• Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ Ğ­ĞšĞ ĞĞ (Ğ¤ĞĞ ĞœĞ Ğ—ĞĞ¯Ğ’ĞšĞ˜) â•â•â• -->
    <div id="mainScreen" class="screen main-screen">
        <h1>ğŸ“‹ ĞĞ¾Ğ²Ğ°Ñ Ğ·Ğ°ÑĞ²ĞºĞ°</h1>

        <!-- ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ -->
        <div class="nav-buttons no-print">
            <button class="btn btn-secondary" onclick="showHistory()">ğŸ“œ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ</button>
            <button class="btn btn-secondary" id="settingsBtn"
                    onclick="showSettings()" style="display:none;">âš™ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</button>
        </div>

        <!-- ĞĞ±Ñ‰Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°ÑĞ²ĞºĞ¸ -->
        <div class="card">
            <h2>ĞĞ±Ñ‰Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ</h2>

            <div class="form-group">
                <label>ĞŸĞ¾Ğ´Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ *</label>
                <select id="department">
                    <option value="">-- Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ --</option>
                </select>
            </div>

            <div class="form-group">
                <label>ĞœĞµÑÑ‚Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ *</label>
                <select id="location">
                    <option value="">-- Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ --</option>
                </select>
            </div>

            <div class="form-group">
                <label>Ğ¤Ğ˜Ğ Ğ·Ğ°ÑĞ²Ğ¸Ñ‚ĞµĞ»Ñ *</label>
                <input type="text" id="fio" placeholder="Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ² Ğ˜.Ğ˜." maxlength="50">
            </div>

            <div class="form-group">
                <label>Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½</label>
                <input type="tel" id="phone" placeholder="+7 (___) ___-__-__" maxlength="20">
            </div>
        </div>

        <!-- Ğ‘Ğ»Ğ¾Ğº Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ĞµĞ¹ -->
        <div class="card">
            <h2>Ğ”Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»Ğ¸ <span id="motorCountBadge" class="motor-count-badge">1</span></h2>
            <div id="motorsContainer">
                <!-- Ğ‘Ğ»Ğ¾ĞºĞ¸ Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· JS -->
            </div>
            <button class="btn btn-secondary" onclick="addMotor()" id="addMotorBtn">
                â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ÑŒ
            </button>
        </div>

        <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ñ„Ğ¾Ñ€Ğ¼Ñ‹ -->
        <div class="no-print">
            <button class="btn btn-primary" id="submitBtn" onclick="submitForm()">
                ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ
            </button>
            <button class="btn btn-secondary" onclick="clearForm()">
                ğŸ—‘ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ
            </button>
        </div>
    </div>

    <!-- â•â•â• Ğ­ĞšĞ ĞĞ Ğ˜Ğ¡Ğ¢ĞĞ Ğ˜Ğ˜ â•â•â• -->
    <div id="historyScreen" class="screen main-screen">
        <h1>ğŸ“œ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ·Ğ°ÑĞ²Ğ¾Ğº</h1>

        <div class="no-print">
            <button class="btn btn-secondary" onclick="showMain()"
                    style="margin-bottom:15px;">â† ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ·Ğ°ÑĞ²ĞºĞµ</button>
        </div>

        <!-- Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ -->
        <div class="card no-print">
            <h2>Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹</h2>
            <div class="filters">
                <div class="form-group">
                    <label>Ğ”Ğ°Ñ‚Ğ° Ñ</label>
                    <input type="date" id="filterDateFrom">
                </div>
                <div class="form-group">
                    <label>Ğ”Ğ°Ñ‚Ğ° Ğ¿Ğ¾</label>
                    <input type="date" id="filterDateTo">
                </div>
                <div class="form-group">
                    <label>ĞŸĞ¾Ğ´Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ</label>
                    <select id="filterDepartment">
                        <option value="">-- Ğ’ÑĞµ --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ĞœĞµÑÑ‚Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸</label>
                    <select id="filterLocation">
                        <option value="">-- Ğ’ÑĞµ --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ğ¤Ğ˜Ğ</label>
                    <input type="text" id="filterFio" placeholder="ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ¤Ğ˜Ğ">
                </div>
                <div class="form-group">
                    <label>ĞĞ¾Ğ¼ĞµÑ€ Ğ·Ğ°ÑĞ²ĞºĞ¸</label>
                    <input type="text" id="filterNumber" placeholder="2025-0001">
                </div>
            </div>
            <button class="btn btn-primary" onclick="loadHistory()">ğŸ” ĞĞ°Ğ¹Ñ‚Ğ¸</button>
        </div>

        <!-- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ -->
        <div id="historyResults">
            <div class="loading">
                <div class="spinner"></div>
                <p>Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…...</p>
            </div>
        </div>

        <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ¸ -->
        <div class="no-print" style="margin-top:15px;">
            <button class="btn btn-secondary" onclick="window.print()">ğŸ–¨ ĞŸĞµÑ‡Ğ°Ñ‚ÑŒ</button>
        </div>
    </div>

    <!-- â•â•â• Ğ­ĞšĞ ĞĞ ĞĞĞ¡Ğ¢Ğ ĞĞ•Ğš â•â•â• -->
    <div id="settingsScreen" class="screen main-screen">
        <h1>âš™ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ²</h1>

        <div class="no-print">
            <button class="btn btn-secondary" onclick="showMain()"
                    style="margin-bottom:15px;">â† ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ·Ğ°ÑĞ²ĞºĞµ</button>
        </div>

        <div class="card">
            <div class="form-group">
                <label>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº</label>
                <select id="settingsListSelect" onchange="loadListForEdit()">
                    <option value="">-- Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ --</option>
                    <option value="departments">ĞŸĞ¾Ğ´Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ</option>
                    <option value="locations">ĞœĞµÑÑ‚Ğ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸</option>
                    <option value="powers">ĞœĞ¾Ñ‰Ğ½Ğ¾ÑÑ‚ÑŒ (ĞºĞ’Ñ‚)</option>
                    <option value="speeds">ĞĞ±Ğ¾Ñ€Ğ¾Ñ‚Ñ‹ (Ğ¾Ğ±/Ğ¼Ğ¸Ğ½)</option>
                    <option value="manufacturers">ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ</option>
                </select>
            </div>
        </div>

        <div id="listEditorContainer" class="card" style="display:none;">
            <h2 id="listEditorTitle">Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ</h2>
            <div id="listEditorItems" class="list-editor"></div>
            <button class="btn btn-secondary" onclick="addListItem()"
                    style="margin-top:10px;">â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
            <button class="btn btn-success" onclick="saveList()"
                    style="margin-top:10px;">ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº</button>
        </div>
    </div>

</div><!-- /container -->
<!-- *** ĞšĞĞĞ•Ğ¦ Ğ§ĞĞ¡Ğ¢Ğ˜ 2 Ğ¸Ğ· 4 *** -->
<!-- *** ĞĞĞ§ĞĞ›Ğ Ğ§ĞĞ¡Ğ¢Ğ˜ 3 Ğ¸Ğ· 4 *** -->
<script>

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ğ“Ğ›ĞĞ‘ĞĞ›Ğ¬ĞĞ«Ğ• ĞŸĞ•Ğ Ğ•ĞœĞ•ĞĞĞ«Ğ•
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

var API_URL = 'https://script.google.com/macros/s/AKfycbztxtpT3in_ox-ArG5z7zRf11vzL2xHrmH8LVNVVQNvd1wmL5FGzuLi3yDZr-qLdtd8/exec';
var API_TIMEOUT = 60000;
var BUFFER_KEY = 'motorRequestBuffer';
var BUFFER_TTL = 24 * 60 * 60 * 1000;

var currentRole = '';
var currentPassword = '';
var motorCount = 0;
var listsData = {
    departments: [],
    locations: [],
    powers: [],
    speeds: [],
    manufacturers: []
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ğ£Ğ¢Ğ˜Ğ›Ğ˜Ğ¢Ğ«
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ ÑĞºÑ€Ğ°Ğ½Ğ¾Ğ² â”€â”€ */
function showScreen(screenId) {
    var screens = document.querySelectorAll('.screen');
    for (var i = 0; i < screens.length; i++) {
        screens[i].classList.remove('active');
    }
    document.getElementById(screenId).classList.add('active');
}

function showMain() { showScreen('mainScreen'); }

/* â”€â”€ Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ â”€â”€ */
var notificationTimer = null;

function showNotification(message, type, duration) {
    type = type || 'success';
    duration = duration || 4000;
    var el = document.getElementById('notification');
    el.className = 'notification ' + type;
    el.innerHTML = message;
    el.classList.add('show');
    if (notificationTimer) clearTimeout(notificationTimer);
    notificationTimer = setTimeout(function() {
        el.classList.remove('show');
    }, duration);
}

/* â”€â”€ API-Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚Ğ¾Ğ¼ â”€â”€ */
function apiRequest(params, callback) {
    var query = Object.keys(params).map(function(key) {
        return encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);
    }).join('&');

    var url = API_URL + '?' + query;
    var done = false;

    var timer = setTimeout(function() {
        if (!done) {
            done = true;
            callback({success: false, error: 'TIMEOUT'});
        }
    }, API_TIMEOUT);

    fetch(url)
        .then(function(response) { return response.json(); })
        .then(function(data) {
            if (!done) {
                done = true;
                clearTimeout(timer);
                callback(data);
            }
        })
        .catch(function(err) {
            if (!done) {
                done = true;
                clearTimeout(timer);
                callback({success: false, error: err.toString()});
            }
        });
}

/* â”€â”€ Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ´Ğ°Ñ‚Ñ‹ â”€â”€ */
function formatNow() {
    var d = new Date();
    var dd = ('0' + d.getDate()).slice(-2);
    var mm = ('0' + (d.getMonth() + 1)).slice(-2);
    var yyyy = d.getFullYear();
    var hh = ('0' + d.getHours()).slice(-2);
    var mi = ('0' + d.getMinutes()).slice(-2);
    return dd + '.' + mm + '.' + yyyy + ' ' + hh + ':' + mi;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ğ‘Ğ£Ğ¤Ğ•Ğ  Ğ”ĞĞĞĞ«Ğ¥ (sessionStorage + TTL 24Ñ‡)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ¾Ñ€Ğ¼Ñ‹ Ğ² Ğ¾Ğ±ÑŠĞµĞºÑ‚ â”€â”€ */
function collectFormData() {
    var data = {
        department: document.getElementById('department').value,
        location: document.getElementById('location').value,
        fio: document.getElementById('fio').value,
        phone: document.getElementById('phone').value,
        motorCount: motorCount,
        motors: []
    };
    for (var i = 1; i <= motorCount; i++) {
        var suffix = (motorCount > 1) ? String(i) : '';
        var block = document.getElementById('motorBlock' + i);
        if (!block) continue;
        data.motors.push({
            motorName:    (document.getElementById('motorName' + suffix) || {}).value || '',
            invNumber:    (document.getElementById('invNumber' + suffix) || {}).value || '',
            manufacturer: (document.getElementById('manufacturer' + suffix) || {}).value || '',
            power:        (document.getElementById('power' + suffix) || {}).value || '',
            speed:        (document.getElementById('speed' + suffix) || {}).value || '',
            reason:       (document.getElementById('reason' + suffix) || {}).value || ''
        });
    }
    return data;
}

/* â”€â”€ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ² Ğ±ÑƒÑ„ĞµÑ€ â”€â”€ */
function saveToBuffer() {
    try {
        var obj = {
            timestamp: Date.now(),
            data: collectFormData()
        };
        sessionStorage.setItem(BUFFER_KEY, JSON.stringify(obj));
    } catch(e) { /* Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ */ }
}

/* â”€â”€ ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ±ÑƒÑ„ĞµÑ€ (Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¾Ğ¹ TTL) â”€â”€ */
function getBufferData() {
    try {
        var raw = sessionStorage.getItem(BUFFER_KEY);
        if (!raw) return null;
        var obj = JSON.parse(raw);
        if (Date.now() - obj.timestamp > BUFFER_TTL) {
            sessionStorage.removeItem(BUFFER_KEY);
            return null;
        }
        return obj.data;
    } catch(e) {
        return null;
    }
}

/* â”€â”€ ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ±ÑƒÑ„ĞµÑ€ â”€â”€ */
function clearBuffer() {
    try {
        sessionStorage.removeItem(BUFFER_KEY);
    } catch(e) { /* Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ */ }
}

/* â”€â”€ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ¸Ğ· Ğ±ÑƒÑ„ĞµÑ€Ğ° â”€â”€ */
function restoreFromBuffer(data) {
    if (!data) return;

    document.getElementById('department').value = data.department || '';
    document.getElementById('location').value = data.location || '';
    document.getElementById('fio').value = data.fio || '';
    document.getElementById('phone').value = data.phone || '';

    /* Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸ Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ */
    var cnt = data.motorCount || 1;
    motorCount = 0;
    document.getElementById('motorsContainer').innerHTML = '';
    for (var i = 0; i < cnt; i++) {
        addMotor();
    }

    /* Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ¿Ğ¾Ğ»Ñ Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ĞµĞ¹ */
    for (var j = 0; j < data.motors.length; j++) {
        var m = data.motors[j];
        var idx = j + 1;
        var suffix = (cnt > 1) ? String(idx) : '';
        var el;
        el = document.getElementById('motorName' + suffix);
        if (el) el.value = m.motorName || '';
        el = document.getElementById('invNumber' + suffix);
        if (el) el.value = m.invNumber || '';
        el = document.getElementById('manufacturer' + suffix);
        if (el) el.value = m.manufacturer || '';
        el = document.getElementById('power' + suffix);
        if (el) el.value = m.power || '';
        el = document.getElementById('speed' + suffix);
        if (el) el.value = m.speed || '';
        el = document.getElementById('reason' + suffix);
        if (el) el.value = m.reason || '';
    }
}

/* â”€â”€ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ â”€â”€ */
function checkAndRestoreBuffer() {
    var data = getBufferData();
    if (!data) return;
    var hasContent = data.fio || data.department ||
        (data.motors && data.motors.length > 0 && data.motors[0].motorName);
    if (!hasContent) {
        clearBuffer();
        return;
    }
    if (confirm('ĞĞ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ½ĞµÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°ÑĞ²ĞºĞ¸.\nĞ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ?')) {
        restoreFromBuffer(data);
        showNotification('Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¸Ğ· Ğ±ÑƒÑ„ĞµÑ€Ğ°', 'success');
    } else {
        clearBuffer();
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ĞĞ’Ğ¢ĞĞ Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function login() {
    var password = document.getElementById('passwordInput').value.trim();
    if (!password) {
        showNotification('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ', 'error');
        return;
    }

    showNotification('Ğ’Ñ…Ğ¾Ğ´ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ...', 'success', 10000);

    apiRequest({action: 'getSettings', password: password}, function(resp) {
        if (resp.success) {
            currentRole = resp.role;
            currentPassword = password;
            listsData.departments = resp.departments || [];
            listsData.locations = resp.locations || [];
            listsData.powers = resp.powers || [];
            listsData.speeds = resp.speeds || [];
            listsData.manufacturers = resp.manufacturers || [];

            initForm();
            showScreen('mainScreen');

            if (currentRole === 'admin') {
                document.getElementById('settingsBtn').style.display = '';
            }

            showNotification('Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ! Ğ Ğ¾Ğ»ÑŒ: ' + currentRole, 'success');

            /* ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ±ÑƒÑ„ĞµÑ€ Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ñ…Ğ¾Ğ´Ğ° */
            setTimeout(function() {
                checkAndRestoreBuffer();
            }, 500);
        } else {
            showNotification(resp.error || 'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°', 'error');
        }
    });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ğ˜ĞĞ˜Ğ¦Ğ˜ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ Ğ¤ĞĞ ĞœĞ« Ğ˜ Ğ¡ĞŸĞ ĞĞ’ĞĞ§ĞĞ˜ĞšĞĞ’
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function initForm() {
    fillSelect('department', listsData.departments);
    fillSelect('location', listsData.locations);
    fillSelect('filterDepartment', listsData.departments, true);
    fillSelect('filterLocation', listsData.locations, true);

    motorCount = 0;
    document.getElementById('motorsContainer').innerHTML = '';
    addMotor();
}

function fillSelect(id, items, addAll) {
    var sel = document.getElementById(id);
    if (!sel) return;
    var firstOption = addAll ? '<option value="">-- Ğ’ÑĞµ --</option>'
                             : '<option value="">-- Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ --</option>';
    sel.innerHTML = firstOption;
    for (var i = 0; i < items.length; i++) {
        var opt = document.createElement('option');
        opt.value = items[i];
        opt.textContent = items[i];
        sel.appendChild(opt);
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ğ‘Ğ›ĞĞšĞ˜ Ğ”Ğ’Ğ˜Ğ“ĞĞ¢Ğ•Ğ›Ğ•Ğ™
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function addMotor() {
    motorCount++;
    var idx = motorCount;
    /* Ğ•ÑĞ»Ğ¸ Ğ¾Ğ´Ğ¸Ğ½ Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ÑŒ â€” ÑÑƒÑ„Ñ„Ğ¸ĞºÑ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹, ĞµÑĞ»Ğ¸ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ â€” Ğ½Ğ¾Ğ¼ĞµÑ€ */
    var suffix = (motorCount > 1) ? String(idx) : '';

    /* Ğ•ÑĞ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ â€” Ğ¿ĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»Ñ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° */
    if (motorCount === 2) {
        renameMotorFields('', '1');
    }

    var block = document.createElement('div');
    block.className = 'motor-block';
    block.id = 'motorBlock' + idx;

    var headerHtml = '<div class="motor-header">'
        + '<span>Ğ”Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ÑŒ â„–' + idx + '</span>'
        + (idx > 1 ? '<button class="remove-motor" onclick="removeMotor(' + idx + ')">âœ• Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ</button>' : '')
        + '</div>';

    block.innerHTML = headerHtml
        + '<div class="form-group">'
        + '  <label>ĞĞ°Ğ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»Ñ</label>'
        + '  <input type="text" id="motorName' + suffix + '" placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: ĞĞ˜Ğ  80" maxlength="30">'
        + '</div>'
        + '<div class="form-group">'
        + '  <label>Ğ˜Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ğ½Ğ¾Ğ¼ĞµÑ€</label>'
        + '  <input type="text" id="invNumber' + suffix + '" placeholder="Ğ˜Ğ½Ğ². Ğ½Ğ¾Ğ¼ĞµÑ€" maxlength="10">'
        + '</div>'
        + '<div class="form-group">'
        + '  <label>ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ</label>'
        + '  <select id="manufacturer' + suffix + '">'
        + '    <option value="">-- Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ --</option>'
        + '  </select>'
        + '</div>'
        + '<div class="form-group">'
        + '  <label>ĞœĞ¾Ñ‰Ğ½Ğ¾ÑÑ‚ÑŒ (ĞºĞ’Ñ‚)</label>'
        + '  <select id="power' + suffix + '">'
        + '    <option value="">-- Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ --</option>'
        + '  </select>'
        + '</div>'
        + '<div class="form-group">'
        + '  <label>ĞĞ±Ğ¾Ñ€Ğ¾Ñ‚Ñ‹ (Ğ¾Ğ±/Ğ¼Ğ¸Ğ½)</label>'
        + '  <select id="speed' + suffix + '">'
        + '    <option value="">-- Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ --</option>'
        + '  </select>'
        + '</div>'
        + '<div class="form-group">'
        + '  <label>ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ñ€ĞµĞ¼Ğ¾Ğ½Ñ‚Ğ°</label>'
        + '  <textarea id="reason' + suffix + '" placeholder="ĞĞ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ½ĞµĞ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ" maxlength="200"></textarea>'
        + '</div>';

    document.getElementById('motorsContainer').appendChild(block);

    fillSelect('manufacturer' + suffix, listsData.manufacturers);
    fillSelect('power' + suffix, listsData.powers);
    fillSelect('speed' + suffix, listsData.speeds);

    updateMotorBadge();
    updateAddMotorButton();
}

function renameMotorFields(oldSuffix, newSuffix) {
    var fields = ['motorName', 'invNumber', 'manufacturer', 'power', 'speed', 'reason'];
    for (var i = 0; i < fields.length; i++) {
        var el = document.getElementById(fields[i] + oldSuffix);
        if (el) el.id = fields[i] + newSuffix;
    }
}

function removeMotor(idx) {
    if (motorCount <= 1) return;
    var block = document.getElementById('motorBlock' + idx);
    if (block) block.remove();

    /* ĞŸĞµÑ€ĞµÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ½ÑƒĞ¼ĞµÑ€Ğ°Ñ†Ğ¸Ñ */
    var container = document.getElementById('motorsContainer');
    var blocks = container.querySelectorAll('.motor-block');
    motorCount = blocks.length;

    for (var i = 0; i < blocks.length; i++) {
        var newIdx = i + 1;
        var oldId = blocks[i].id;
        blocks[i].id = 'motorBlock' + newIdx;

        var header = blocks[i].querySelector('.motor-header span');
        if (header) header.textContent = 'Ğ”Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ÑŒ â„–' + newIdx;

        /* ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑÑƒÑ„Ñ„Ğ¸ĞºÑ */
        var newSuffix = (motorCount > 1) ? String(newIdx) : '';

        /* ĞŸĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»Ñ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ±Ğ»Ğ¾ĞºĞ° */
        var fields = ['motorName', 'invNumber', 'manufacturer', 'power', 'speed', 'reason'];
        for (var j = 0; j < fields.length; j++) {
            var inputs = blocks[i].querySelectorAll('[id^="' + fields[j] + '"]');
            for (var k = 0; k < inputs.length; k++) {
                inputs[k].id = fields[j] + newSuffix;
            }
        }

        /* ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ */
        var removeBtn = blocks[i].querySelector('.remove-motor');
        if (newIdx === 1 && removeBtn) {
            removeBtn.remove();
        } else if (newIdx > 1 && removeBtn) {
            removeBtn.setAttribute('onclick', 'removeMotor(' + newIdx + ')');
        }
    }

    updateMotorBadge();
    updateAddMotorButton();
}

function updateMotorBadge() {
    document.getElementById('motorCountBadge').textContent = motorCount;
}

function updateAddMotorButton() {
    document.getElementById('addMotorBtn').style.display =
        (motorCount >= 10) ? 'none' : '';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ĞĞ§Ğ˜Ğ¡Ğ¢ĞšĞ Ğ¤ĞĞ ĞœĞ«
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function clearForm() {
    document.getElementById('department').value = '';
    document.getElementById('location').value = '';
    document.getElementById('fio').value = '';
    document.getElementById('phone').value = '';

    motorCount = 0;
    document.getElementById('motorsContainer').innerHTML = '';
    addMotor();

    /* ĞÑ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ Ğ±ÑƒÑ„ĞµÑ€ Ğ²Ğ¼ĞµÑÑ‚Ğµ Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ¾Ğ¹ */
    clearBuffer();
}

/* *** ĞšĞĞĞ•Ğ¦ Ğ§ĞĞ¡Ğ¢Ğ˜ 3 Ğ¸Ğ· 4 *** ĞĞĞ§ĞĞ›Ğ Ğ§ĞĞ¡Ğ¢Ğ˜ 4 Ğ¸Ğ· 4 *** */


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ĞĞ¢ĞŸĞ ĞĞ’ĞšĞ Ğ—ĞĞ¯Ğ’ĞšĞ˜
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function submitForm() {
    var department = document.getElementById('department').value;
    var location   = document.getElementById('location').value;
    var fio        = document.getElementById('fio').value.trim();
    var phone      = document.getElementById('phone').value.trim();

    if (!department || !location || !fio) {
        showNotification('Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ (Ğ¿Ğ¾Ğ´Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ, Ğ¼ĞµÑÑ‚Ğ¾, Ğ¤Ğ˜Ğ)', 'error');
        return;
    }

    /* Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² Ğ±ÑƒÑ„ĞµÑ€ Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹ */
    saveToBuffer();

    var params = {
        action:     'submit',
        department: department,
        location:   location,
        fio:        fio,
        phone:      phone,
        dateStr:    formatNow(),
        motorCount: motorCount
    };

    for (var i = 1; i <= motorCount; i++) {
        var suffix = (motorCount > 1) ? String(i) : '';
        params['motorName' + suffix]    = (document.getElementById('motorName' + suffix) || {}).value || '';
        params['invNumber' + suffix]    = (document.getElementById('invNumber' + suffix) || {}).value || '';
        params['manufacturer' + suffix] = (document.getElementById('manufacturer' + suffix) || {}).value || '';
        params['power' + suffix]        = (document.getElementById('power' + suffix) || {}).value || '';
        params['speed' + suffix]        = (document.getElementById('speed' + suffix) || {}).value || '';
        params['reason' + suffix]       = (document.getElementById('reason' + suffix) || {}).value || '';
    }

    var submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'â³ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ°...';

    apiRequest(params, function(resp) {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºÑƒ';

        if (resp.success) {
            /* Ğ£ÑĞ¿ĞµÑ… â€” Ğ¾Ñ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ¸ Ğ±ÑƒÑ„ĞµÑ€ */
            showNotification('âœ… Ğ—Ğ°ÑĞ²ĞºĞ° ' + resp.requestNumber + ' ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ°! '
                + 'Ğ”Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ĞµĞ¹: ' + resp.motorsProcessed, 'success', 6000);
            clearForm();
        } else if (resp.error === 'TIMEOUT') {
            /* Ğ¢Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ â€” Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ, Ğ±ÑƒÑ„ĞµÑ€ Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ */
            showNotification(
                'âš  ĞĞµÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ¾Ñ‚ ÑĞµÑ€Ğ²ĞµÑ€Ğ°. Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾, Ğ·Ğ°ÑĞ²ĞºĞ° Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ°.<br>'
                + 'ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ <b>Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ</b>. Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ² Ğ±ÑƒÑ„ĞµÑ€Ğµ.<br>'
                + '<button class="btn-retry" onclick="submitForm()">ğŸ”„ ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ</button>',
                'warning', 15000
            );
        } else {
            /* Ğ”Ñ€ÑƒĞ³Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° â€” Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ, Ğ±ÑƒÑ„ĞµÑ€ Ğ¾ÑÑ‚Ğ°Ñ‘Ñ‚ÑÑ */
            showNotification(
                'âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: ' + (resp.error || 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°') + '<br>'
                + 'Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ² Ğ±ÑƒÑ„ĞµÑ€Ğµ.<br>'
                + '<button class="btn-retry" onclick="submitForm()">ğŸ”„ ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ</button>',
                'error', 15000
            );
        }
    });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ğ˜Ğ¡Ğ¢ĞĞ Ğ˜Ğ¯ Ğ—ĞĞ¯Ğ’ĞĞš
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function showHistory() {
    showScreen('historyScreen');
    loadHistory();
}

function loadHistory() {
    var resultsDiv = document.getElementById('historyResults');
    resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</p></div>';

    var params = {
        action:   'getHistory',
        password: currentPassword,
        limitRows: 20
    };

    /* Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğ°Ğ¼ */
    var dateFrom = document.getElementById('filterDateFrom').value;
    var dateTo   = document.getElementById('filterDateTo').value;
    if (dateFrom) {
        var pf = dateFrom.split('-');
        params.dateFrom = pf[2] + '.' + pf[1] + '.' + pf[0];
    }
    if (dateTo) {
        var pt = dateTo.split('-');
        params.dateTo = pt[2] + '.' + pt[1] + '.' + pt[0];
    }

    /* Ğ•ÑĞ»Ğ¸ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹ Ğ´Ğ°Ñ‚Ñ‹ â€” ÑƒĞ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ (Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ·Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´) */
    if (dateFrom || dateTo) {
        params.limitRows = 10000;
    }

    /* ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ */
    var fd = document.getElementById('filterDepartment').value;
    var fl = document.getElementById('filterLocation').value;
    var ff = document.getElementById('filterFio').value.trim();
    var fn = document.getElementById('filterNumber').value.trim();

    if (fd) params.department = fd;
    if (fl) params.location = fl;
    if (ff) params.fio = ff;
    if (fn) params.requestNumber = fn;

    apiRequest(params, function(resp) {
        if (resp.success) {
            renderHistory(resp.requests || []);
        } else {
            resultsDiv.innerHTML = '<div class="card" style="text-align:center;color:#ff4757;">'
                + 'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸: ' + (resp.error || 'ĞĞµÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°') + '</div>';
        }
    });
}

function renderHistory(requests) {
    var resultsDiv = document.getElementById('historyResults');

    if (requests.length === 0) {
        resultsDiv.innerHTML = '<div class="card" style="text-align:center;">'
            + 'Ğ—Ğ°ÑĞ²ĞºĞ¸ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹</div>';
        return;
    }

    var html = '<div class="table-container">'
        + '<table class="history-table">'
        + '<thead><tr>'
        + '<th>â„– Ğ·Ğ°ÑĞ²ĞºĞ¸</th>'
        + '<th>Ğ”Ğ°Ñ‚Ğ°</th>'
        + '<th>ĞŸĞ¾Ğ´Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ</th>'
        + '<th>ĞœĞµÑÑ‚Ğ¾</th>'
        + '<th>Ğ”Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ÑŒ</th>'
        + '<th>Ğ˜Ğ½Ğ².â„–</th>'
        + '<th>ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ</th>'
        + '<th>ĞœĞ¾Ñ‰Ğ½Ğ¾ÑÑ‚ÑŒ</th>'
        + '<th>ĞĞ±Ğ¾Ñ€Ğ¾Ñ‚Ñ‹</th>'
        + '<th>ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°</th>'
        + '<th>Ğ¤Ğ˜Ğ</th>'
        + '<th>Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½</th>'
        + '</tr></thead><tbody>';

    for (var i = 0; i < requests.length; i++) {
        var r = requests[i];
        html += '<tr>'
            + '<td>' + escapeHtml(r.requestNumber) + '</td>'
            + '<td>' + escapeHtml(r.date) + '</td>'
            + '<td>' + escapeHtml(r.department) + '</td>'
            + '<td>' + escapeHtml(r.location) + '</td>'
            + '<td>' + escapeHtml(r.motorName) + '</td>'
            + '<td>' + escapeHtml(r.invNumber) + '</td>'
            + '<td>' + escapeHtml(r.manufacturer) + '</td>'
            + '<td>' + escapeHtml(r.power) + '</td>'
            + '<td>' + escapeHtml(r.speed) + '</td>'
            + '<td>' + escapeHtml(r.reason) + '</td>'
            + '<td>' + escapeHtml(r.fio) + '</td>'
            + '<td>' + escapeHtml(r.phone) + '</td>'
            + '</tr>';
    }

    html += '</tbody></table></div>';
    html += '<div style="text-align:center;margin-top:10px;color:#4a8ed4;font-size:13px;">'
        + 'ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹: ' + requests.length + '</div>';

    resultsDiv.innerHTML = html;
}

function escapeHtml(text) {
    if (!text) return '';
    return String(text)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ Ğ¡ĞŸĞ ĞĞ’ĞĞ§ĞĞ˜ĞšĞĞ’ (ĞĞ”ĞœĞ˜Ğ)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function showSettings() {
    if (currentRole !== 'admin') {
        showNotification('ĞĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°', 'error');
        return;
    }
    showScreen('settingsScreen');
    document.getElementById('settingsListSelect').value = '';
    document.getElementById('listEditorContainer').style.display = 'none';
}

function loadListForEdit() {
    var listName = document.getElementById('settingsListSelect').value;
    if (!listName) {
        document.getElementById('listEditorContainer').style.display = 'none';
        return;
    }

    var titles = {
        departments:   'ĞŸĞ¾Ğ´Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ',
        locations:     'ĞœĞµÑÑ‚Ğ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸',
        powers:        'ĞœĞ¾Ñ‰Ğ½Ğ¾ÑÑ‚ÑŒ (ĞºĞ’Ñ‚)',
        speeds:        'ĞĞ±Ğ¾Ñ€Ğ¾Ñ‚Ñ‹ (Ğ¾Ğ±/Ğ¼Ğ¸Ğ½)',
        manufacturers: 'ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ'
    };

    document.getElementById('listEditorTitle').textContent = titles[listName] || listName;
    document.getElementById('listEditorContainer').style.display = '';

    var items = listsData[listName] || [];
    var container = document.getElementById('listEditorItems');
    container.innerHTML = '';

    for (var i = 0; i < items.length; i++) {
        addListItemElement(items[i]);
    }
}

function addListItem() {
    addListItemElement('');
}

function addListItemElement(value) {
    var container = document.getElementById('listEditorItems');
    var item = document.createElement('div');
    item.className = 'list-item';
    item.innerHTML = '<input type="text" value="' + escapeHtml(value) + '" placeholder="Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ">'
        + '<button class="remove-item" onclick="this.parentElement.remove()">âœ•</button>';
    container.appendChild(item);
}

function saveList() {
    var listName = document.getElementById('settingsListSelect').value;
    if (!listName) return;

    var items = [];
    var inputs = document.querySelectorAll('#listEditorItems .list-item input');
    for (var i = 0; i < inputs.length; i++) {
        var val = inputs[i].value.trim();
        if (val) items.push(val);
    }

    showNotification('Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ...', 'success', 10000);

    apiRequest({
        action:   'updateList',
        password: currentPassword,
        listName: listName,
        items:    items.join('|||')
    }, function(resp) {
        if (resp.success) {
            listsData[listName] = items;
            initForm();
            showNotification('âœ… Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½ (' + resp.count + ' Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹)', 'success');
        } else {
            showNotification('âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: ' + (resp.error || 'ĞĞµÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°'), 'error');
        }
    });
}

</script>
</body>
</html>
<!-- *** ĞšĞĞĞ•Ğ¦ Ğ§ĞĞ¡Ğ¢Ğ˜ 4 Ğ¸Ğ· 4 *** -->

